<!DOCTYPE html>
<html>
<head>
    <title>Premier College Finder</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #eef2f7;
            color: #333;
        }
        #root {
            max-width: 900px;
            margin: 20px auto;
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #004085;
            margin-bottom: 30px;
        }
        .search-controls {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #b8daff;
            border-radius: 8px;
            background-color: #e9f3ff;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        .control-group {
            display: flex;
            flex-direction: column;
        }
        label {
            margin-bottom: 8px;
            font-weight: bold;
            color: #004085;
        }
        input[type="text"], input[type="number"], select {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1rem;
        }
        button {
            grid-column: 1 / -1; /* Span across all columns */
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: background-color 0.3s ease, opacity 0.3s ease;
        }
        button:hover:not(:disabled) {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .results-list {
            margin-top: 30px;
        }

        .college-item {
            background: #ffffff;
            border: 1px solid #dee2e6;
            margin-bottom: 15px;
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .college-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .college-item h3 {
            margin-top: 0;
            margin-bottom: 5px;
            color: #007bff;
        }
        .college-item p {
            margin-bottom: 5px;
            font-size: 0.95rem;
            color: #555;
        }
         .college-item p strong {
             color: #333;
         }

        .loading, .error {
            text-align: center;
            padding: 20px;
            font-weight: bold;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .loading {
            color: #f39c12;
            background-color: #fff3cd;
            border-color: #ffecb5;
        }
        .error {
            color: #c0392b;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }

        /* --- Modal Styles --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            max-width: 700px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            border: none;
            background: none;
            color: #aaa;
            transition: color 0.2s ease;
        }
        .modal-close:hover {
            color: #777;
        }

        .modal-content h2 {
            margin-top: 0;
            color: #004085;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
         .modal-content h4 {
             margin-top: 15px;
             margin-bottom: 10px;
             color: #0056b3;
         }
        .modal-content p {
            margin-bottom: 8px;
            font-size: 1rem;
            color: #444;
        }
        .modal-content a {
             color: #007bff;
             text-decoration: none;
        }
         .modal-content a:hover {
             text-decoration: underline;
         }
         .modal-content ul {
             padding-left: 20px;
             margin-top: 5px;
         }
          .modal-content ul li {
             margin-bottom: 5px;
             color: #444;
          }
    </style>
</head>
<body>

    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Helper function to format numbers (add commas)
        const formatNumber = (num) => {
            if (num === null || num === undefined) return 'N/A';
            return num.toLocaleString();
        };

         // Helper function to format currency
        const formatCurrency = (num) => {
             if (num === null || num === undefined) return 'N/A';
             return '$' + num.toLocaleString();
        };

        // Helper function to format percentages
        const formatPercentage = (num) => {
             if (num === null || num === undefined) return 'N/A';
             // API percentages are often 0-1, convert to 0-100
             return (num * 100).toFixed(1) + '%';
        };


        // Component for displaying detailed college info in a modal
        const CollegeDetailModal = ({ college, onClose }) => {
            if (!college) return null; // Don't render if no college is selected

            const safeGet = (obj, path, formatter = (val) => val) => {
                 const keys = path.split('.');
                 let current = obj;
                 for (const key of keys) {
                     if (current === null || current === undefined) return 'N/A';
                     current = current[key];
                 }
                 return formatter(current);
            };

            return (
                <div className="modal-overlay" onClick={onClose}> {/* Close modal when clicking outside */}
                    <div className="modal-content" onClick={e => e.stopPropagation()}> {/* Prevent click inside from closing */}
                        <button className="modal-close" onClick={onClose}>&times;</button>

                        <h2>{safeGet(college, 'school.name')}</h2>

                        <p><strong>Location:</strong> {safeGet(college, 'school.city')}, {safeGet(college, 'school.state')} {safeGet(college, 'school.zip')}</p>
                        <p><strong>Website:</strong> {safeGet(college, 'school.school_url', (url) => url ? <a href={url} target="_blank" rel="noopener noreferrer">{url}</a> : 'N/A')}</p>
                        <p><strong>Ownership:</strong> {safeGet(college, 'school.ownership', (val) => {
                            // Map ownership codes to readable names
                            const ownershipMap = {
                                1: 'Public',
                                2: 'Private Non-profit',
                                3: 'Private For-profit'
                            };
                            return ownershipMap[val] || 'N/A';
                        })}</p>
                         <p><strong>Degree Types:</strong> {safeGet(college, 'school.degrees_awarded.predominant', (val) => {
                             // Map degree codes
                            const degreeMap = {
                                 0: 'Non-Degree-Granting',
                                 1: "Certificate Degree",
                                 2: "Associate Degree",
                                 3: "Bachelor's Degree",
                                 4: "Graduate Degree"
                             };
                             return degreeMap[val] || 'N/A';
                         })}</p>

                        <h4>Admissions</h4>
                        <p><strong>Overall Admission Rate:</strong> {safeGet(college, 'latest.admissions.admission_rate.overall', formatPercentage)}</p>
                        <ul>
                            <li><strong>SAT Critical Reading (25th-75th Percentile):</strong> {safeGet(college, 'latest.admissions.sat.25_percentile.critical_reading')} - {safeGet(college, 'latest.admissions.sat.75_percentile.critical_reading')}</li>
                            <li><strong>SAT Math (25th-75th Percentile):</strong> {safeGet(college, 'latest.admissions.sat.25_percentile.math')} - {safeGet(college, 'latest.admissions.sat.75_percentile.math')}</li>
                            <li><strong>ACT Composite (25th-75th Percentile):</strong> {safeGet(college, 'latest.admissions.act.25_percentile.composite')} - {safeGet(college, 'latest.admissions.act.75_percentile.composite')}</li>
                        </ul>
                         <p><small>Note: Percentile scores may not be available for all institutions or years.</small></p>


                        <h4>Cost & Aid</h4>
                        <p><strong>Total Annual Attendance Cost:</strong> {safeGet(college, 'latest.cost.attendance.academic_year', formatCurrency)}</p>
                        <p><strong>Tuition and Fees (In-State):</strong> {safeGet(college, 'latest.cost.tuition.in_state', formatCurrency)}</p>
                        <p><strong>Tuition and Fees (Out-of-State):</strong> {safeGet(college, 'latest.cost.tuition.out_of_state', formatCurrency)}</p>
                        <p><strong>Federal Loan Rate:</strong> {safeGet(college, 'latest.aid.federal_loan_rate', formatPercentage)} <small>(% of undergraduate students receiving federal loans)</small></p>

                        <h4>Outcomes</h4>
                         <p><strong>Student Size:</strong> {safeGet(college, 'latest.student.size', formatNumber)}</p>
                        <p><strong>Median Earnings 6 Years After Entry:</strong> {safeGet(college, 'latest.earnings.6_yrs_after_entry.median', formatCurrency)}</p>
                        <p><strong>Median Earnings 10 Years After Entry:</strong> {safeGet(college, 'latest.earnings.10_yrs_after_entry.median', formatCurrency)}</p>
                         <p><strong>4-Year Completion Rate (Pell Grant Recipients):</strong> {safeGet(college, 'latest.completion.completion_rate_4yr_pell', formatPercentage)}</p>


                        {/* Add more detailed fields as needed */}

                    </div>
                </div>
            );
        };


        // Main App Component
        const App = () => {
            // !!! IMPORTANT: Replace with your actual Data.gov API key !!!
            const DATA_GOV_API_KEY = "vwOMaF6FXDv56kEaDt0ocaumS9FhF1c6ckp1n4Mz"; // <-- PUT YOUR KEY HERE
            const API_BASE_URL = "https://api.data.gov/ed/collegescorecard/v1/schools.json?";

            // State for search and filters
            const [searchTerm, setSearchTerm] = useState('');
            const [minSize, setMinSize] = useState('');
            const [maxSize, setMaxSize] = useState('');
            const [maxTuition, setMaxTuition] = useState(''); // Using max attendance cost

            // State for results and UI state
            const [colleges, setColleges] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [selectedCollege, setSelectedCollege] = useState(null); // State to manage modal visibility and data

            // Define the fields we want to fetch (a comprehensive list)
            const API_FIELDS = [
                'id',
                'school.name',
                'school.city',
                'school.state',
                'school.zip',
                'school.school_url',
                'school.ownership',
                'school.degrees_awarded.predominant',
                'latest.student.size',
                'latest.admissions.admission_rate.overall',
                'latest.admissions.sat.25_percentile.critical_reading',
                'latest.admissions.sat.75_percentile.critical_reading',
                'latest.admissions.sat.25_percentile.math',
                'latest.admissions.sat.75_percentile.math',
                'latest.admissions.act.25_percentile.composite',
                'latest.admissions.act.75_percentile.composite',
                'latest.cost.attendance.academic_year', // Use attendance cost as a general figure
                'latest.cost.tuition.in_state',
                'latest.cost.tuition.out_of_state',
                'latest.aid.federal_loan_rate',
                'latest.earnings.6_yrs_after_entry.median',
                'latest.earnings.10_yrs_after_entry.median',
                'latest.completion.completion_rate_4yr_pell', // Example outcome
                // Add more fields here as desired for detailed view
            ].join(','); // Join with comma for the API parameter

            const handleSearch = async () => {
                if (!DATA_GOV_API_KEY || DATA_GOV_API_KEY === "YOUR_DATA.GOV_API_KEY") {
                    setError("Please replace 'YOUR_DATA.GOV_API_KEY' with your actual Data.gov API key.");
                    return;
                }

                setLoading(true);
                setError(null);
                setColleges([]); // Clear previous results
                setSelectedCollege(null); // Close modal if open

                let queryParams = new URLSearchParams({
                    api_key: DATA_GOV_API_KEY,
                    fields: API_FIELDS,
                    per_page: 100 // Fetch up to 100 results (API limit per page is 100)
                    // For a real product, you'd implement pagination
                });

                // Add search term filter (basic contains search)
                if (searchTerm) {
                    // Using __autocomplete or __fulltext might be better, but __contains is simpler
                    queryParams.append('school.name__contains', searchTerm);
                }

                // Add size filter
                if (minSize && maxSize) {
                    queryParams.append('latest.student.size__range', `${minSize}..${maxSize}`);
                } else if (minSize) {
                    queryParams.append('latest.student.size__gte', minSize);
                } else if (maxSize) {
                    queryParams.append('latest.student.size__lte', maxSize);
                }

                // Add tuition filter (using max attendance cost)
                if (maxTuition) {
                    queryParams.append('latest.cost.attendance.academic_year__lte', maxTuition);
                }

                const url = `${API_BASE_URL}${queryParams.toString()}`;
                console.log("Fetching URL:", url);

                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                         const errorBody = await response.json().catch(() => null); // Try to parse JSON error, but don't fail if it's not JSON
                         const errorMessage = errorBody && errorBody.message ? errorBody.message : response.statusText;
                         throw new Error(`HTTP error! status: ${response.status}, message: ${errorMessage}`);
                    }
                    const data = await response.json();

                    if (!data.results || data.results.length === 0) {
                         setColleges([]);
                         setError("No colleges found matching your criteria.");
                    } else {
                         setColleges(data.results);
                    }

                } catch (e) {
                    console.error("Fetch error:", e);
                    setError("Failed to fetch college data. Please check your API key and network connection. Error details: " + e.message);
                } finally {
                    setLoading(false);
                }
            };

             // Function to open the modal with college details
            const openCollegeModal = (college) => {
                setSelectedCollege(college);
            };

            // Function to close the modal
            const closeCollegeModal = () => {
                setSelectedCollege(null);
            };


            return (
                <div>
                    <h1>Premier College Finder</h1>

                    <div className="search-controls">
                        <div className="control-group">
                            <label htmlFor="searchTerm">College Name:</label>
                            <input
                                id="searchTerm"
                                type="text"
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                                placeholder="e.g., Harvard University"
                            />
                        </div>

                        <div className="control-group">
                             <label>Student Size:</label>
                             <input
                                 type="number"
                                 value={minSize}
                                 onChange={(e) => setMinSize(e.target.value)}
                                 placeholder="Min size"
                             />
                        </div>
                         <div className="control-group">
                              <label>&nbsp;</label> {/* Placeholder for alignment */}
                              <input
                                  type="number"
                                  value={maxSize}
                                  onChange={(e) => setMaxSize(e.target.value)}
                                  placeholder="Max size"
                              />
                         </div>


                         <div className="control-group">
                            <label htmlFor="maxTuition">Max Annual Attendance Cost:</label>
                            <input
                                id="maxTuition"
                                type="number"
                                value={maxTuition}
                                onChange={(e) => setMaxTuition(e.target.value)}
                                placeholder="e.g., 30000"
                            />
                        </div>


                        <button onClick={handleSearch} disabled={loading}>
                            {loading ? 'Searching...' : 'Search Colleges'}
                        </button>
                    </div>

                    {error && <div className="error">{error}</div>}
                    {loading && <div className="loading">Loading colleges...</div>}


                    <div className="results-list">
                        {colleges.length > 0 && <h2>Found Colleges ({colleges.length})</h2>}
                        {colleges.map(college => (
                            <div
                                key={college.id}
                                className="college-item"
                                onClick={() => openCollegeModal(college)} // Make the card clickable
                            >
                                <h3>{college['school.name']}</h3>
                                <p><strong>Location:</strong> {college['school.city']}, {college['school.state']}</p>
                                <p><strong>Student Size:</strong> {formatNumber(college['latest.student.size'])}</p>
                                 <p><strong>Latest Attendance Cost:</strong> {formatCurrency(college['latest.cost.attendance.academic_year'])}</p>
                                {/* Display other summary info */}
                            </div>
                        ))}
                    </div>

                    {/* Render the modal if a college is selected */}
                    <CollegeDetailModal
                        college={selectedCollege}
                        onClose={closeCollegeModal}
                    />

                </div>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);

    </script>
</body>
</html>
